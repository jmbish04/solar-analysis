{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Optimize DB insertions in handleBackfillPvwatts",
      "description": "Use env.DB.batch() to batch hourly inserts in handleBackfillPvwatts for better performance. This reduces 24 separate requests per day to a single batch.",
      "file": "solar-analyzer-worker/src/services/pvwattsBackfill.ts",
      "priority": "high",
      "done": true
    },
    {
      "label": "Fix hourly NEM3/NEM2 calculation",
      "description": "Correct the calculation for the hourly difference between NEM3 and NEM2 so the NEM3 credit reduction only applies when there is net generation (h.usage - h.pv < 0). For net consumption, the difference should be zero.",
      "file": "solar-analyzer-worker/public/index.html",
      "priority": "high",
      "done": true
    },
    {
      "label": "Avoid N+1 query pattern in nemAnalysis",
      "description": "Refactor fetching of usage and PV data to use a single SQL query with JOIN, rather than iterating by date and making multiple queries. Improves performance for large date ranges.",
      "file": "solar-analyzer-worker/src/services/nemAnalysis.ts",
      "priority": "critical",
      "done": true
    },
    {
      "label": "Add test case for net generation scenario",
      "description": "Add a test case for net generation (PV > usage, net < 0) to verify correctness of the else branch in the cost calculation logic in handleNemAnalysis.",
      "file": "solar-analyzer-worker/test/index.spec.ts",
      "priority": "medium",
      "done": true
    }
  ]
}
